<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.32.1/mapbox-gl.css' rel='stylesheet' />
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-92988185-1', 'auto');
      ga('send', 'pageview');
    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <style>
        body {
          margin:0;
          padding:0;
          background-color: #087fcb;
          font-family: 'Roboto', sans-serif;
        }
        #app {
          /*background-color: rgb(193, 193, 193);*/
          background-color: #087fcb;
          padding: 0;
          width: 100%;
        }

        #app img {
          width: auto;
          max-height: 100px;
          height: 10vh;
        }

        #app h1 {
          color: #FFF;
          font-size: 10px;
          font-size: 2.7vw;
          font-weight: normal;
        }

        #map img {
         max-width: none;
         min-width: 0px;
        }
        #map {
          height: 600px;
          height: 88vh;
        }
        #moreinfo {
          background-color: white;
        }
        #menu {
            background: #fff;
            position: absolute;
            z-index: 1;
            top: 10px;
            right: 10px;
            border-radius: 3px;
            width: 120px;
            border: 1px solid rgba(0,0,0,0.4);
            font-family: 'Open Sans', sans-serif;
        }

        #menu a {
            font-size: 13px;
            color: #404040;
            display: block;
            margin: 0;
            padding: 0;
            padding: 10px;
            text-decoration: none;
            border-bottom: 1px solid rgba(0,0,0,0.25);
            text-align: center;
        }

        #menu a:last-child {
            border: none;
        }

        #menu a:hover {
            background-color: #f8f8f8;
            color: #404040;
        }

        #menu a.active {
            background-color: #3887be;
            color: #ffffff;
        }

        #menu a.active:hover {
            background: #3074a4;
        }

        #feedback {
          /*float: right;*/
          margin-left: 3vw;
        }

        .overlay {
          position:absolute;
          top:0;
          left:0;
          right:0;
          bottom:0;
          background-color:rgba(0, 0, 0, 0.75);
          z-index:9999;
          color:white;
          text-align: center;
          display: none;
        }

        .overlay:before {
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -0.25em;
        }

        .feedback_container {
            display: inline-block;
            vertical-align: middle;
            padding: 10px 15px;
            position:relative;
            font-weight:bold;
            background-color: #FFF;
            color: #000;
            border-radius: 5px;
        }

        .feedback_container input {
          display: block;
          margin: 5px 0px;
        }

        .feedback_container label {
          display: block;
          text-align: left;
          position: relative;
        }

        #overlay_close {
          width: 30px;
          position: absolute;
          top: -15px;
          right: -15px;
        }

    </style>
 </script>
</head>
<body>
<style>
  .mapboxgl-popup {
      max-width: 400px;
      font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  }
</style>

<div class="navbar navbar-fixed-top">
  <div class="col-sm-2 col-md-3"></div>
  <div id="menu"></div>
</div>

<div class="container" id="app">
    <img class="col-xs-12" src="logo.png">
    <h1>Property Buddy - what you want to know before buying...
      <button type="button" class="btn btn-primary" id="feedback">Feedback!</button>
    </h1>
    <div class="col-xs-12">
      <div id="map"></div>
    </div>
</div>

<div class="overlay" id="overlay">
  <div class="feedback_container">
    <img src="cross.png" id="overlay_close">
    <form action="https://formspree.io/thepropertybuddy@gmail.com" method="POST">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" name="name" class="form-control">
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" name="_replyto" class="form-control">
        </div>
        <div class="form-group">
          <label for="Phone Number">Phone</label>
          <input type="text" name="phone" class="form-control">
        </div>
        <div class="form-group">
          <label for="feedback">Feedback</label>
          <textarea name="Text1" cols="40" rows="5"></textarea>
        </div>
        <div class="form-group">
          <label for="pay">How much might you pay for this product?</label>
          <input type="range" name="pay" value="0" min="0" max="200" step="1" oninput="updatePay(value)">
          <output for="pay" id="pay_value">$0 per month</output>
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
    </form>
  </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script>

function updatePay(value) {
	document.querySelector('#pay_value').value = "$" + value + " per month";
}

$("#feedback").click(function(event) {
  event.preventDefault();
  $("#overlay").fadeToggle("fast");
});

$("#overlay_close").click(function(event){
  event.preventDefault();
  $("#overlay").fadeToggle("fast");
});

mapboxgl.accessToken = 'pk.eyJ1IjoibG13cmlnaHQ4OSIsImEiOiJjaXp2MmI5bm8wMHB2MnduaDdkcWV0OWV0In0.yVDv6j4s-4f11Lhu-EQw1w';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/lmwright89/cizv2bzpp000o2smj7927zc2k',
    zoom: 14,
    center: [153.037,-27.493]
});

var popup = new mapboxgl.Popup({
    closeButton: false,
    closeOnClick: false
});

var toggleableLayerIds = [
  'Crime Data',
  'Heritage - Local',
  'Heritage - State',
  'Master Plan',
  'Proposed',
  'Under Construction',
  'River Flood'
];

map.on('mousemove', function(e) {
    var features = map.queryRenderedFeatures(e.point, {
      layers: toggleableLayerIds
    });
    // Change the cursor style as a UI indicator.
    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup.remove();
      return;
    }

    var feature = features[0];
    var coordinates = null;
    if (feature.geometry.type == 'Point') {
      coordinates = feature.geometry.coordinates;
    } else if (feature.geometry.type == 'Polygon') {
      coordinates = feature.geometry.coordinates[0][0];
    } else if (feature.geometry.type == 'MultiPolygon') {
      coordinates = feature.geometry.coordinates[0][0][0];
    } else {
      //console.log('else', feature.geometry);
    }
    // Populate the popup and set its coordinates
    // based on the feature found.
    if (coordinates) {
      popup.setLngLat(coordinates)
          .setHTML(feature.layer.id)
          .addTo(map);
    }
});


for (var i = 0; i < toggleableLayerIds.length; i++) {
    var id = toggleableLayerIds[i];

    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = id;

    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };

    var layers = document.getElementById('menu');
    layers.appendChild(link);
}


</script>

</body>
</html>
